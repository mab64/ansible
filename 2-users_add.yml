---
- name: Create users
  become: yes
  hosts: nodes
  gather_facts: false
  vars:
    users:
      - user: Alice
        password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          32353633393536633230636166663337616238326336323539353837643664323935326261386633
          3134653961613663623035323136636335393962396136360a623836353638356337313331383862
          30396336313964666537613731393832303864623036383031623864633238653964353330393961
          3337343866366566620a616664626464663136343165363938613439396332643865656662373166
          6438
      - user: Bob
        password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          32383865353266663836313539373136616538643434626235396265343463343331383164386365
          3436666564303062643938313135323666626139656634380a613262353436333562626634623337
          61336233643363343766303332343432393162326235313139386634386337653165376431613537
          3332346339633434320a663364346365633365633363373864653838376130646334373638366564
          3535
      - user: Carol
        password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          66613565666461613739363631303237633230653562326237316334653236373131623436636364
          6566636264386233353939656266663835653934343238300a303366626336336564633763653864
          65613062383664316238666333343138353865656531393366383632376265336235306562336535
          3833303439646139620a363338663639643937376233386135613465633764613162633839626662
          6134
 
        

  tasks:
#    - debug: var=users

    - name: Create users from dict
      user:
        name: "{{ item.user }}"
        home: "/home/{{ item.user }}"
        comment: "{{ item.user }}@example.com"
        password: "{{ item.password | password_hash('sha512')}}"
        update_password: on_create
      loop: "{{ users }}"

